(()=>{"use strict";var e={729:e=>{var t=Object.prototype.hasOwnProperty,n="function"!=typeof Object.create&&"~";function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function i(){}i.prototype._events=void 0,i.prototype.eventNames=function(){var e,r=this._events,i=[];if(!r)return i;for(e in r)t.call(r,e)&&i.push(n?e.slice(1):e);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(r)):i},i.prototype.listeners=function(e,t){var r=n?n+e:e,i=this._events&&this._events[r];if(t)return!!i;if(!i)return[];if(i.fn)return[i.fn];for(var o=0,a=i.length,s=new Array(a);o<a;o++)s[o]=i[o].fn;return s},i.prototype.emit=function(e,t,r,i,o,a){var s=n?n+e:e;if(!this._events||!this._events[s])return!1;var c,u,l=this._events[s],h=arguments.length;if("function"==typeof l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,i),!0;case 5:return l.fn.call(l.context,t,r,i,o),!0;case 6:return l.fn.call(l.context,t,r,i,o,a),!0}for(u=1,c=new Array(h-1);u<h;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var f,v=l.length;for(u=0;u<v;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),h){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,r);break;default:if(!c)for(f=1,c=new Array(h-1);f<h;f++)c[f-1]=arguments[f];l[u].fn.apply(l[u].context,c)}}return!0},i.prototype.on=function(e,t,i){var o=new r(t,i||this),a=n?n+e:e;return this._events||(this._events=n?{}:Object.create(null)),this._events[a]?this._events[a].fn?this._events[a]=[this._events[a],o]:this._events[a].push(o):this._events[a]=o,this},i.prototype.once=function(e,t,i){var o=new r(t,i||this,!0),a=n?n+e:e;return this._events||(this._events=n?{}:Object.create(null)),this._events[a]?this._events[a].fn?this._events[a]=[this._events[a],o]:this._events[a].push(o):this._events[a]=o,this},i.prototype.removeListener=function(e,t,r,i){var o=n?n+e:e;if(!this._events||!this._events[o])return this;var a=this._events[o],s=[];if(t)if(a.fn)(a.fn!==t||i&&!a.once||r&&a.context!==r)&&s.push(a);else for(var c=0,u=a.length;c<u;c++)(a[c].fn!==t||i&&!a[c].once||r&&a[c].context!==r)&&s.push(a[c]);return s.length?this._events[o]=1===s.length?s[0]:s:delete this._events[o],this},i.prototype.removeAllListeners=function(e){return this._events?(e?delete this._events[n?n+e:e]:this._events=n?{}:Object.create(null),this):this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prototype.setMaxListeners=function(){return this},i.prefixed=n,e.exports=i},418:e=>{var t=Object.prototype.propertyIsEnumerable;function n(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function r(e){var n=Object.getOwnPropertyNames(e);return Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(e))),n.filter((function(n){return t.call(e,n)}))}e.exports=Object.assign||function(e,t){for(var i,o,a=n(e),s=1;s<arguments.length;s++){i=arguments[s],o=r(Object(i));for(var c=0;c<o.length;c++)a[o[c]]=i[o[c]]}return a}}},t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{const e=jQuery;var t=n.n(e);const r="streamDidUpdate",i="streamListDidUpdate";function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$view=this.render(t),this.$thumbnail=this.$view.find(".stream-thumbnail"),this.$viewerCount=this.$view.find(".stream-viewers"),this.$author=this.$view.find(".stream-author"),this.$game=this.$view.find(".stream-game"),this.$thumbnail.on("click",(function(){window.open("https://twitch.tv/"+t.channel.display_name)})),this.update(t)}var n,r;return n=e,(r=[{key:"getView",value:function(){return this.$view}},{key:"render",value:function(e){var n=t()("<div/>",{class:"stream-preview"});return n.html('\n        <div class="stream-thumbnail-holder">\n            <img class="stream-thumbnail"/>\n        </div>\n        <div class="stream-stats">\n            <i class="fa fa-user"></i><span class="stream-viewers"></span>\n        </div>\n        <div class="stream-info">\n            <div class="stream-logo-holder"><img class="stream-logo" src="'.concat(e.channel.profile_image_url,'"/></div>\n            <div class="stream-information"><div class="stream-author"></div><div class="stream-game"></div>\n        </div>\n        ')),n}},{key:"update",value:function(e){var t=e.stream.thumbnail_url;t=(t=t.replace("{width}",216)).replace("{height}",144),this.$thumbnail.attr("src",t),this.$viewerCount.text(e.stream.viewer_count),this.$author.text(e.channel.display_name),this.$game.text(e.stream.game_name)}}])&&o(n.prototype,r),e}();function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=function(){function e(n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=n,this.payload=r,this.$view=t()("<div></div>").addClass("twitch-monitor-player"),this.draw()}var n,r;return n=e,(r=[{key:"draw",value:function(){this.preview=new a(this.payload),this.$view.append(this.preview.getView())}},{key:"getName",value:function(){return this.name}},{key:"getView",value:function(){return this.$view}},{key:"update",value:function(e){this.preview.update(e)}}])&&s(n.prototype,r),e}();function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l=function(){function e(n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$root=t()(r),this.$container=t()("<div></div>").addClass("twitch-monitor-container").addClass("vertical"===n?"layout-vertical":"layout-row"),this.$root.append(this.$container),this.children={}}var n,r;return n=e,(r=[{key:"add",value:function(e,t){var n=new c(e,t);this.addChild(n)}},{key:"addChild",value:function(e){this.children[e.getName()]=e,this.$container.append(e.getView())}},{key:"getStreamCount",value:function(){return Object.keys(this.children).length}},{key:"hasStream",value:function(e){return!!this.children[e]}},{key:"remove",value:function(e,t){this.hasStream(e)&&(this.children[e].getView().remove(),delete this.children[e])}},{key:"update",value:function(e,t){this.children[e].update(t)}}])&&u(n.prototype,r),e}(),h=n(729),f=n.n(h),v=n(418),p=n.n(v);const d=socket;var y=n.n(d);function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var O=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(c,e);var t,n,o,a,s=(o=c,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=_(o);if(a){var n=_(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return g(this,e)});function c(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(e=s.call(this)).cache={},setTimeout((function(){e.updateCache(),e.subscribe()}),0),e}return t=c,(n=[{key:"getCachedStreams",value:function(){return this.cache}},{key:"subscribe",value:function(){var e=this;y().on("plugins.ns-twitch-monitor.streamUpdate",(function(t){e.updateItemInCache(t),e.emit(r,t)}))}},{key:"updateCache",value:function(){var e=this;y().emit("plugins.ns-twitch-monitor.streamPayloadsGet",null,(function(t,n){if(t)return console.warn("Error has occurred, can not update initial cache for twitch monitor, error: %s",t.message);e.cache=p()({},e.cache,n),e.emit(i,e.cache)}))}},{key:"updateItemInCache",value:function(e){e&&("offline"===e.status?delete this.cache[e.channel.name]:this.cache[e.channel.name]=e)}}])&&w(t.prototype,n),c}(f());function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var j=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.view=t,this.limit=n}var t,n;return t=e,(n=[{key:"dispose",value:function(){}},{key:"updateStream",value:function(e){var t=e.channel.display_name,n=0;this.view.getStreamCount()>=this.limit&&(n=.5),!e.stream||n>Math.random()?this.view.remove(t,e):this.view.hasStream(t)?this.view.update(t,e):!this.view.hasStream(t)&&this.view.getStreamCount()<this.limit&&this.view.add(t,e)}}])&&k(t.prototype,n),e}();function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var x=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.socketService=new O,this.socketService.on(r,this.streamDidUpdate.bind(this)),this.socketService.on(i,this.streamListDidUpdate.bind(this))}var t,n;return t=e,(n=[{key:"disposeIfNeeded",value:function(){this.viewController&&(console.warn("Twitch Monitor is disposed"),this.viewController.dispose(),this.viewController=null)}},{key:"init",value:function(e,t,n){console.warn("Created Twitch Monitor"),this.disposeIfNeeded(),this.viewController=new j(new l(t,n),e);var r=this.socketService.getCachedStreams();for(var i in r)this.streamDidUpdate(r[i])}},{key:"streamDidUpdate",value:function(e){this.viewController&&this.viewController.updateStream(e)}},{key:"streamListDidUpdate",value:function(e){for(var t in e)e.hasOwnProperty(t)&&this.streamDidUpdate(e[t])}}])&&C(t.prototype,n),e}();window.ns=window.ns||{},window.ns.TwitchMonitor=new x})()})();